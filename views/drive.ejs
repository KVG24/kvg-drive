<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/style.css" />
        <script src="/main.js" defer></script>
        <title><%= user.username %> drive</title>
    </head>
    <body>
        <a class="log-out-link" href="/log-out">Log Out</a>

        <h1><%= user.username %> drive</h1>
        <div class="files-container">
            <% if (folderPath) { %>
            <div class="folder-path">/<%= folderPath %></div>
            <% } %>
            <div class="control-btns">
                <% if (folder.id !== user.rootFolderId && parentFolder) { %>
                <div
                    class="back-to-parent-btn"
                    onclick="window.location.href='/drive/<%= parentFolder.id %>'"
                >
                    <img src="/icons/back.svg" alt="folder icon" />
                </div>
                <% } %>
                <button
                    class="add-folder-btn"
                    type="button"
                    onclick="openCreateFolderModal()"
                >
                    <img src="/icons/new.svg" />
                </button>
                <button
                    class="upload-files-btn"
                    type="button"
                    onclick="openUploadFilesModal()"
                >
                    Upload files
                </button>
            </div>
            <div class="folders-container">
                <% if (subfolders) { %>
                <!-- comment to prevent linter ruining markup in VS Code -->
                <% subfolders.forEach(function(subfolder) { %>
                <div class="folder" data-id="<%= subfolder.id %>">
                    <img src="/icons/folder.svg" />
                    <%= subfolder.name %>
                    <button
                        type="button"
                        onclick="toggleConfirmDeleteModal('<%= subfolder.id %>')"
                        class="delete-folder-btn"
                    >
                        <img src="/icons/delete.svg" />
                    </button>
                    <%- include('partials/confirmDeleteModal', { subfolder }) %>
                </div>
                <% }) %> <% } %>
            </div>
            <% if (files) {%> <% files.forEach((file) => { %>
            <div class="file">
                <div class="file-name"><%= file.name %></div>
                <div class="file-size"><%= file.size / 1000 %> KB</div>
                <div class="file-uploaded"><%= file.uploaded %></div>
                <div class="file-btn-container">
                    <button
                        type="button"
                        onclick="openShareModal('<%= file.id %>', '<%= folder.id %>', '<%= file.filename %>')"
                    >
                        <img src="/icons/share.svg" />
                    </button>
                    <a href="/download/<%= folder.id %>/<%= file.filename %>"
                        ><img src="/icons/download.svg"
                    /></a>
                    <a
                        class="delete-btn"
                        href="/delete/<%= folder.id %>/<%= file.filename %>"
                        ><img src="/icons/delete.svg"
                    /></a>
                </div>
                <%- include('partials/shareFileModal', { file }) %>
            </div>
            <% }) %> <% } %>
        </div>
        <%- include('partials/uploadFilesModal', { folder }) %> <%-
        include('partials/createFolderModal', { folder }) %>
        <div class="modal-overlay" style="display: none"></div>
        <div class="loader-overlay" style="display: none">
            <div class="loader"></div>
        </div>
    </body>
</html>
